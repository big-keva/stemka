<html>

<head>
  <title>Стемка- морфологический анализ для небольших поисковых систем</title>
<body>

<h1><center>Вероятностный морфологический анализатор русского и украинского языков</center></h1>

<div align="center"><font size="-1"><i>
  Оригинал статьи в журнале <a href="http://www.samag.ru/ru/articles/">"Системный Администратор"</a>
</i></font></div>

<br>

<div align="justify">
Поисковые и не только поисковые системы Интернет столь популярны сегодня, что 
люди проводят часы, обсуждая достоинства и недостатки той или иной, алгоритмы 
и программы для поиска полнотекстовой информации на тех или иных носителях. И 
все это время не утихают горячие споры "профи" поиска и "ленивых пользователей". 
Первые - сторонники чисто "механических" машин, поисковых систем, которые вычисляют 
строгие логические запросы и поддерживают усечение слова справа "звёздочкой"; 
они убеждены, что лучше всяких алгоритмов сформулируют, что же им нужно найти. 
Другие - наоборот, стараются отдать на откуп алгоритмам поисковика все магические 
преобразования исходного запроса и не задумываться о том, что же там происходит 
внутри.<br>
Обе точки зрения имеют право на существование, и я даже знаю нескольких таких 
профи, которые способны действительно грамотно сформулировать логический запрос 
на поиск нужной информации, корректно расставив скобки и применив соответствующие 
усечения. Однако подавляющее большинство пользователей, к коим я отношу и себя, 
все-таки скорее "лентяи".<br>
Один достаточно иллюстративный диалог произошел на выставке SofTool в 1995 году. 
Компания <i>Агама</i>, где я в тот момент работал,
представляла одноименную систему поиска информации, размещенной на локальных
дисках компьютера. Надо сказать, эта поисковая система уже тогда, несмотря
на убогость DOS, под управлением коего она работала, уже делала полноценный словарный
морфологический анализ обрабатываемых текстов и поисковых запросов, то есть
умела искать с учетом всех форм русских слов. И вот одна дама, протестировав систему
и побеседовав о морфологической обработке текстов с господином Пархоменко, идеологом
и руководителем проекта, воскликнула на весь зал: "Да ведь это никому не нужно! Я сама
прекрасно все найду, дайте мне только оператор усечения!". На беду, оператор усечения,
как и весь традиционный набор логических операторов, в языке запросов присутствовал.
После получаса стучания по клавишам дама со словами: "Вы меня не убедили!", - покинула
стенд.<br>

Действительно, лицензировать систему морфологического анализа за несколько тысяч 
долларов для использования ее в разработке продукта под конкретного заказчика, 
когда бюджет проекта не сильно превышает эту сумму - не самая лучшая идея.<br>
Что же делать в такой ситуации? Есть два решения. Первое - не использовать лингвистических 
алгоритмов вообще, если это возможно. Второе - остановиться на стемминге, то есть 
на формальном выделении основы - стабильной, графически неизменной при склонении 
или спряжении, части слова.<br>
Программы, выполняющие стемминг, или стеммеры, также существуют примерно столько 
же, сколько и поисковые системы. И, надо отметить, в случае английского языка, 
(достаточно простого и не склонного к излишней флективности, то есть изменчивости 
слов), стеммеры успешно справляются с поставленной перед ними задачей. Так, классический 
"портеровский" алгоритм, хоть он и грешит сведением упоминавшейся аббревиатуры 
DOS к формальной основе - глаголу do, тем не менее дает вполне корректное значение 
отношения "сигнал/шум" в случае поиска информации.<br>
Хуже обстоит дело со славянскими языками. Выделить правила, по которым можно отсечь 
часть слова справа, да так, чтобы не породить сильного шума, очень сложно, и построение 
такого набора правил сравнимо по трудоемкости с построением полноценного словарного 
морфологического анализатора, чем обычно и заканчиваются доведенные до логического 
завершения разработки в этой области. Приведем простой пример - слово кровать. 
До сих пор все программы стемминга для русского языка успешно и совершенно логично 
признавали это слово изменяющимся по модели глагола, выделяя или формальную основу 
"кр" или в лучше случае, "кров". Уважаемый читатель, мне кажется, по достоинству 
оценит такой глагол - "я крую/кроваю, он кровает/круёт".<br>
Однако за истекший год в этом направлении были сделаны серьезные шаги. <i>Мартин 
Портер (Martin Porter)</i> сделал доступными свои наработки в области стемминга, наборы 
правил и инструменты для работы с ними, для открытого сетевого сообщества, опубликовав 
проект на <a href="http://snowball.sourceforge.net/">SourceForge</a>.Проект представляет
собой специализированный язык обработки строк, предназначенный для изготовления алгоритмов 
стемминга в информационном поиске. Довольно быстро проект стал расширяться, и 
сейчас доступны в исходных текстах стеммеры для английского, французского, испанского, 
португальского, итальянского, немецкого, датского, шведского и норвежского языков. 
Русский поначалу остался в стороне, однако недавно появилась поддержка и
<a href="http://snowball.sourceforge.net/russian/stemmer.html">для него</a>.<br>

Тем не менее, по ряду причин, часть из которых обсуждалась выше, стеммер Snowball 
все равно далек от идеала. И основная причина заключается в том, что он базируется 
на обобщенных правилах, составленных людьми, в лучшем случае - лингвистами. А 
как известно, любое общее правило имеет исключения, приводящие в данном случае 
к неправильному выделению основы. Еще одно нарекание - это "убежденность алгоритма 
в собственной непогрешимости": алгоритм всегда дает один-единственный вариант 
формальной основы слова, игнорируя все остальные по внутренним соображениям. Именно 
в силу указанных недостатков и было принято решение о разработке своего алгоритма 
и правил стемминга.<br>
Отмечу сразу, что мыслей разрабатывать вручную правила усечения русских слов не 
было даже изначально, но было большое желание изготовить алгоритм, который учитывал 
бы и сочетаемость букв в слове на границе возможного усечения, и частотность такой 
модели словоизменения. Поэтому было принято решение строить правила стемминга 
автоматически, обрабатывая большие массивы русских текстов. Задача сильно облегчалась 
наличием русского морфологического анализатора, разработанного еще в 1994 году 
во время работы над проектом "Пропись 4.0". Анализатор этот работает и поныне 
в поисковых системах <a href="http://www.aport.ru/">Апорт!</a>, <a href="http://www.rambler.ru">
Рамблер</a>, <a href="http://www.meta.ua/">МЕТА</a>, хотя и пережил несколько преобразований,
в результате чего словарь уже придирчиво выверен, а код позволяет обрабатывать до 20 - 30
тысяч слов в секунду. Подробнее с этим анализатором и условиями его распространения можно
ознакомиться на этом же сайте.<br>

Для представления автоматических правил усечения слов была выбрана модель хранения 
возможного окончания с двумя предшествующими буквами неизменяемой части слова. 
Так, например, словоформа <b><i>словарями</i></b> порождает правило, разрешающее отщепление 
окончания <b><i>-ями</i></b> при условии, что ему предшествует последовательность
<b><i>-ар-</i></b>. Аналогично, встретив словоформу <b><i>морями</b></i>, мы породим
правило о возможном отщеплении того же окончания (<b><i>-ями</b></i>) при условии, что
оно встретилось после фрагмента <b><i>-ор-</b></i>.<br>

Далее была изготовлена программа обработки массивов полнотекстовой информации, 
которая, разбив текст на слова, выполняла обработку очередной потенциальной словоформы 
точным морфологическим анализатором; при этом неизвестные словарному анализатору 
строки игнорировались, что является допустимой погрешностью, поскольку, имея базу 
более 150,000 основ и распознавая более четырех миллионов различных форм русских 
слов, анализатор игнорирует менее одного процента встретившихся строк, которые 
по большей части оказываются либо орфографическими ошибками, либо аббревиатурами, 
либо экзотическими названиями или именами собственными. Для опознанных же словоформ 
выделялась их точная основа, то есть часть слова, остающаяся неизменной при склонении 
или спряжении; выделенное таким способом окончание вкупе с последними двумя символами 
формальной основы поступало в накопитель, который либо регистрировал новое правило, 
либо увеличивал вес уже существующего правила отщепления окончания.<br>

По завершении работы сканера текстов получившийся массив данных был отранжирован 
в соответствии с убыванием вероятности встретить каждую из присутствующих моделей 
словоизменения, после чего модели, вероятность реализации которых составляла менее 
одной десятитысячной, были отброшены как редкие и потенциально опасные, т. е. способные
породить избыточный шум.<br>

Результат - набор потенциальных окончаний с условиями на предшествующие символы 
- был инвертирован для удобства сканирования словоформ "справа налево" и представлен 
в виде таблицы переходов конечного автомата. Подробнее устройство таких таблиц 
описано в статье о <a href="../ling/rus/help.htm">словарном морфологическом
анализаторе</a>.

Далее был разработан переносимый программный код на языке C, обеспечивающий сканирование 
подаваемых на вход форм слов на полученных таблицах переходов. Особо следует отметить, 
что код этот не берет на себя ответственность за выбор конкретного способа усечения, 
но лишь строит все допустимые варианты выделения формальной основы. Так, для словоформы 
<b><i>начинающихся</i></b> анализатор выделит формальные основы длиной 6, 8 и 10 символов,
что соответствует глаголу <b><i>начина-ть</i></b>, причастию <b><i>начинающ-ий</i></b> и
возвратной форме - <b><i>начанающий-ся</i></b>, то есть выделит псевдоморфемы, участвующие
в образовании этого слова. Программа-клиент, например поисковая машина, вправе либо
самостоятельно принять решение о выборе того или иного варианта усечения, либо запомнить
все построенные варианты, что обеспечит максимальную полноту поиска. С другой стороны,
для многострадального слова <b><i>кровать</b></i> обученный таким образом алгоритм выделит
лишь одну формальную основу - шестибуквенную последовательность <b><i>кроват</b></i>-ь,
что полностью соответствует истине. В ряде ситуаций анализатор принимает решение о
невозможности какого-либо усечения по данной последовательности, как, например, в
случае слова <b><i>компьютер</b></i>, что также полностью соответствует действительности.<br>

По ходу тестирования и отладки построенной технологии было введено дополнительное 
правило, ограничивающее свободу алгоритма. Суть правила состоит в том, что формальная 
основа слова должна содержать хотя бы одну гласную, иначе возможно построение 
весьма некорректных основ, как, например, усечение слова <b><i>спам</i></b> до основы
<b><i>сп</i></b>, что, как известно, является распространенной аббревиатурой словосочетания
"совместное предприятие". Интересно, что большинство стеммеров, в том числе и используемый 
в поисковой системе <a href="http://www.yandex.ru">Яndex</a> для обработки неизвестных
слов, грешат в подобных ситуациях, в чем несложно убедиться, дав соответствующий запрос.<br>

Для обеспечения должной производительности анализатор не строит строк, а лишь 
возвращает набор возможных длин формальных основ, которые можно выделить из строки. 
Инициализация модуля также не требуется, так как все таблицы переходов представлены 
статическими данными.<br>
Особое внимание пришлось уделить поддержке различных кодовых страниц и возможной 
капитализации - начертанию слов в верхнем регистре. Действительно, при всей привлекательности 
кодировки 1251 Windows Cyrillic и удобстве работы с ней, она не является ни единственной, 
ни даже самой популярной. Преобразовывать же строку из иных кодировок в желаемую 
перед анализом весьма и весьма дорого по меркам "скорострельных" алгоритмов. Для 
обеспечения совместимости анализатора с текстами в различных кодировках предусмотрена 
возможность его настройки передачей дополнительного параметра - таблицы преобразования 
кодов символов из произвольной кодировки в нижний регистр кодировки 1251 размерностью 
256 байт. Если этот параметр не задан, то по умолчанию используется встроенная 
таблица преобразования символов верхнего регистра кодовой страницы Windows Cyrillic 
в символы нижнего регистра.<br>
Хочется отметить, что весной 2002 года в лаборатории общей и компьютерной лексикографии 
кафедры русского языка Московского Государственного университета было проведено 
сравнительное тестирование трех программ русского стемминга: Snowball, описываемого 
алгоритма и стеммера, разработанного там же под руководством докторов филологических 
наук А. А. Поликарпова и О. В. Кукушкиной. По результатам тестирования описываемый 
стеммер показал наиболее корректные в лингвистическом отношении результаты при 
максимальной полноте и минимальном шуме, то есть количестве неверно выделенных 
основ.<br>
Позже описанным способом был разработан также словарь стемминга украинского языка, 
который вместе с русским успешно применяется для анализа неизвестных слов в украинской 
поисковой системе (www.meta-ukraine.com), а также изготовлена программа, позволяющая 
автоматически строить таблицы стемминга для других языков из словарей ISpell, 
доступных в сети Интернет. Однако следует оговориться, что в последнем случае 
качество получаемого словаря напрямую зависит от качества используемых материалов, 
которое чаще всего весьма низко.<p>
Представленный продукт доступен в исходных текстах и может использоваться
в свободной форме с условием ссылки на источник. Архив можно загрузить
<a href="./stemka.tar.gz">здесь</a>.<br>
Если же Вы заинтересованы в дальнейших публикациях некоторых моих разработок
на тех условиях - свободное использование и открытый исходный код - то можете
оставить автору чаевые в любом размере, который Вас не затруднит. Как говорится,
с миру по нитке - Андрюше на новый BMW.<p>
</div>


<center>

<script src=http://narod.yandex.ru/wallet.js language=javascript></script>

      <form method=POST action=http://127.0.0.1:8129/wallet>
        <input type=hidden name=wbp_Version value=2>
        <input type=hidden name=wbp_MessageType value=DirectPaymentIntoAccountRequest>
        <input type=hidden name=wbp_ShopAddress value="keva@rambler.ru">
        <input type=hidden name=wbp_accountid value="4100128691091">
        <input type=hidden name=wbp_currencyamount value="643;100">
        <a href=http://money.yandex.ru/>
          <img src=http://narod.yandex.ru/pics/u/money.gif align=middle height=19 width=24 border=0>
        </a>&nbsp;&nbsp;&nbsp;<a href=http://money.yandex.ru/>Яндекс.Деньгами: </a>
          Сумма: <input size=4 name=SummR maxlength=31 value=1000> руб.
            <input type=hidden size=2 name=SummC value=00 maxlength=2>
            <input type=hidden name=wbp_shortdescription value="Чаевые за использование libstemka">
          <input type=hidden name=wbp_ShopErrorInfo value="Деньги не отправлены">
          <input type=submit value="Подкинуть Андрюше денег :)" onClick="return onClick_href(event, this );">
      </form>

<b><i><font size="+1" color=blue>Большое спасибо!</font></i></b>
</center>

<center>

<!--LiveInternet counter--><script type="text/javascript"><!--
document.write("<a href='http://www.liveinternet.ru/click' "+
"target=_blank><img src='http://counter.yadro.ru/hit?t57.6;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";"+Math.random()+
"' alt='' title='LiveInternet' "+
"border=0 width=88 height=31><\/a>")//--></script><!--/LiveInternet-->

</center>

</body>
</html>
